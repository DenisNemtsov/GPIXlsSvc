# GPIXlsSvc v1.5
##### Gazprom Inform Xls Service



Небольшое приложение в виде службы Windows разработанное для ООО "Газпром переработка" и предназначенное для получения по электронной почте, разбора файла "Справки по состоянию парков" от УМТСиК на Уренгойском ЗПКТ и записи полученных данных в тэги PI Server'а ДУ ИУС П П.



#### Функциональные возможности:

1. Приложение может быть запущено как в интерактивном режиме, т.е. как обычное консольное приложение, так и в режиме службы Windows. Второй 
режим запуска требует регистрации службы в ОС.
2. Возможна самостоятельная регистрация приложения как службы Windows при помощи команды: "**GPIXlsSvc.exe install**" (без кавычек). Удаление службы можно произвести при помощи команды: "**GPIXlsSvc.exe uninstall**" (без кавычек).
3. Программа не имеет графического интерфейса, поэтому все настройки осуществляются при помощи корректировки файла "**GPIXlsSvc.ini**", краткое описание которого содержится в разделе "**Настройка приложения**".
4. Для корректной работы приложения требуется установленная PISDK от OSISoft LLC., версии 1.4.0 (2010) и выше. Для самостоятельной сборки приложения требуется .NET Core SDK версии 3.1 и выше.



#### Настройка приложения:

##### I. 	**Раздел "Service"**

​	1). Пункт "Interval" - Задает интервал основного цикла приложения, т.е. опроса почтового ящика, разбора полученных и записи данных в тэги PI Server'а.
​	2). Пункт "PIServer" - Адрес PI Server'а для записи данных в тэги.		
​	3). Пункт "Folder" - Полный путь к папке в которую помещаются Excel-файлы для обработки, в процессе работы внутри папки создается папка "Processed" для сохранения обработанных файлов.
​	4). Пункт "SaveTime" - Устанавливает время записи данных в тэги, может принимать значения: "Now()" - взять текущее время, "GetFromFile()"-взять время из шапки обрабатываемого файла, "06:00"-жестко- заданное время на которое будут записаны данные.
​	5). Пункт "Filter" - Расширение файлов для обработки (не сильно актуально на данный момент, осталось с предыдущих версий).

##### II.	**Раздел Tags**

​	1). Пункт любой - Имена тэгов в которые будет производиться запись извлеченных данных.



#### История версий:

|      Версия      | Описание                                                     |
| :--------------: | :----------------------------------------------------------- |
| 13.02.2018(v1.0) | Стартовая версия приложения.                                 |
| 14.02.2018(v1.1) | Добавлен алгоритм разбора файлов из локальной (Сетевой) папки без получения файлов по электронной почте. |
| 15.02.2018(v1.2) | Библиотека Microsoft.Office.Interop.Excel заменена на EPPlus, теперь для разбора файлов не требуется установленный Microsoft Office. |
| 20.02.2018(v1.2) | Добавлен разбор еще одного столбца (5) из исходного файла.   |
| 27.02.2018(v1.2) | Добавлена корректировка временной метки на +2 часа.          |
|                  | Добавлено чтение строк "Реализация продукта за прошедшие сутки" и запись их в тэги. |
| 06.03.2018(v1.2) | Изменен формат временной метки, теперь дата берется из шапки документа, а время берется текущее. |
| 16.03.2018(v1.2) | Добавлена настройка времени записи данных в тэги, см. "Настройка приложения", п.IV, п.п.3 |
| 26.03.2018(v1.2) | Добавлена обработка поля "Свободный объём для  заполнения (тн.)". |
| 11.04.2019(v1.3) | Исправлена ошибка из-за которой не обрабатывалась последняя строка исходного .xls-файла. |
|                  | Библиотека Microsoft.Exchange.WebServices.dll теперь подключается локально без установки в репозиторий. |
| 26.12.2019(v1.5) | Полностью удален функционал для получения файлов по электронной почте (используется сторонний перекладчик). |
|                  | Исходный код полностью переписан и портирован на платформу .Net Core 3.1. |
|                  | Добавлена поддержка фреймворков:                             |
|                  | "Topshelf v4.2.1.218" - Создание служб Windows,              |
|                  | "Serilog v2.9.0" - Запись журнала в файл, вывод журнала в консоль, |
|                  | "SharpConfig v3.2.8" - Чтение/запись конфигурационных файлов, |
|                  | "EPPlus v4.5.3.2" - Работа ч файлами Microsoft Excel.        |
|                  | Изменен формат конфигурационного файла, удалены ненужные пункты, добавлены все тэги в которые производится запись. |